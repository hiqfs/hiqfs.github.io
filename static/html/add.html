<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Img</title>
    <script>
        var writeHtml = (obj) => {
            var objStr = JSON.stringify(obj, null, 4);
            var html = objStr.replace(/\n/g, '<br>').replace(/\s/g, '&nbsp');
            document.getElementById("event").innerHTML=html;
        }
        var JsonApiSrc = "https://json.extendsclass.com";
        var JsonApiId = "bac32c6aa445";
        var AddImgSrc = (Src, Pass) => {
            fetch(JsonApiSrc + "/bin/" + JsonApiId, {
                method: "PATCH",
                headers: {
                    "Content-type": "application/json-patch+json",
                    "Security-key": Pass,
                },
                body: JSON.stringify({
                    op: "add",
                    path: "/AvatarListId/0",
                    value: Src
                })
            })
                .then(response => response.json())
                .then(date => {
                    if (date) {
                        console.log("ok");
                        console.log(JSON.parse(date.data));
                        writeHtml(JSON.parse(date.data));
                    }
                    else console.log(date);
                });
        }
        window.onload = (e) => {
            document.getElementById("button").onclick = (eh) => {
                var url = new URL(document.getElementById("url").value);
                var fliename = url.pathname.split("/");
                fliename=fliename[fliename.length-1].split(".")[0];
                console.log(document.getElementById("password").value);
                AddImgSrc(fliename,document.getElementById("password").value);
            }
        }
    </script>
</head>

<body>
    <input id="url">
    <br><input id="password">
    <br><button id="button">发送</button>
    <p>返回结果</p>
    <br>
    <div id="event">
    </div>
</body>

</html>